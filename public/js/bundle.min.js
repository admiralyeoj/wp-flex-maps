(()=>{"use strict";(()=>{class t{constructor(t,e=[]){if(this.valid=!0,!t)return this.valid=!1,!1;let o=this;this.markers=[],this.zoom=10,this.element=t,this.mapId=this.element.getAttribute("data-map"),this.meta_vars=e.meta_vars||[],this.tax_vars=e.tax_vars||[],this.initialZoom=!0,this.myOptions={zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP},this.infoWindow=new google.maps.InfoWindow({post_id:null}),google.maps.event.addListener(this.infoWindow,"domready",(function(){document.getElementById("post-"+this.post_id).parentNode.parentNode.parentNode.classList.add("fm-marker")})),this.map=new google.maps.Map(t,{center:{lat:0,lng:0},zoom:1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControl:!1,streetViewControl:!1,scaleControl:!1}),google.maps.event.addListener(this.map,"zoom_changed",(function(){var t=google.maps.event.addListener(o.map,"bounds_changed",(function(e){this.getZoom()>17&&1==o.initialZoom&&(this.setZoom(17),o.initialZoom=!1),google.maps.event.removeListener(t)}))})),"latlng"==this.element.getAttribute("data-load-type")?this.load_by_latlng():this.load_by_search()}load_by_search(){let t=this;if(this.valid){var e={action:"flex_maps_get_locations",mapId:this.mapId,meta_vars:this.meta_vars,tax_vars:this.tax_vars};jQuery.post(flex_map.ajax_url,e,(function(e){let o=e.data;if(jQuery(t.element).siblings(".fm-spinner-container").fadeOut(),e.success){let e=new google.maps.LatLngBounds;if(o.locations&&0!=o.locations.length){for(var a in o.locations){var n=o.locations[a];(i=new google.maps.LatLng(parseFloat(n.lat),parseFloat(n.lng))).lat()&&i.lng()&&(t.create_marker(n),e.extend(i))}t.map.fitBounds(e)}else{let a={lat:o.origin.geometry.location.lat,lng:o.origin.geometry.location.lng,ID:"origin",title:"Current Location",marker_html:o.origin.html};var i=new google.maps.LatLng(parseFloat(a.lat),parseFloat(a.lng));t.create_marker(a),e.extend(i),t.map.fitBounds(e)}}else console.error(o.message)}))}}load_by_latlng(){let t=this,e=this.element.getAttribute("data-lat")?this.element.getAttribute("data-lat"):0,o=this.element.getAttribute("data-lng")?this.element.getAttribute("data-lng"):0,a=parseInt(this.element.getAttribute("data-zoom"))?parseInt(this.element.getAttribute("data-zoom")):10,n=new google.maps.LatLng(e,o);if(this.map.setCenter(n),this.map.setZoom(a),this.element.getAttribute("data-show_marker")){let e=new google.maps.Marker({position:n,html:'<div id="post-'+this.element.id+'" class="fm-container">'+this.element.getAttribute("data-popup_window_content")+"</div>",map:this.map,post_id:this.element.id}),o=this.element.getAttribute("data-popup_type");o&&"none"!=o&&(google.maps.event.addListener(e,"click",(function(){t.infoWindow.setContent(e.html),t.infoWindow.open(t.map,e),t.infoWindow.setOptions({post_id:e.post_id})})),"load"==o&&google.maps.event.trigger(e,"click"),this.markers.push(e))}jQuery(t.element).siblings(".fm-spinner-container").fadeOut()}create_marker(t){var e=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng));let o={map:this.map,position:e,title:name,post_id:t.ID,html:'<div id="post-'+t.ID+'" class="fm-container">'+t.marker_html+"</div>"};t.icon&&(o.icon=t.icon);let a=new google.maps.Marker(o),n=this;google.maps.event.addListener(a,"click",(function(){n.infoWindow.setContent(a.html),n.infoWindow.open(n.map,a),n.infoWindow.setOptions({post_id:a.post_id})})),this.markers.push(a)}clear_markers(){this.infoWindow.close();for(var t=0;t<this.markers.length;t++)this.markers[t].setMap(null);this.markers=[]}}var e;(e=jQuery)((function(){})),e(window).on("load",(function(){})),window.FM_Init_Map=()=>{let e=document.querySelectorAll(".fm-autocomplete");for(let t=0;t<e.length;t++)new google.maps.places.Autocomplete(e[t]);let o=document.querySelectorAll(".fm-google-map");o.length>0&&o.forEach((function(e,o){new t(e,flex_map.map[e.id].query)}))}})()})();